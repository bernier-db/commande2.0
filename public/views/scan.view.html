<style type="text/css">
    div.fileinputs {
        position: relative;
    }
    
    div.fakefile {
        position: absolute;
        top: 0px;
        left: 0px;
        z-index: 1;
    }
    
    div.fakefile input[type=button] {
        /* enough width to completely overlap the real hidden file control */
        cursor: pointer;
        width: 148px;
    }
    
    div.fileinputs input.file {
        position: relative;
        text-align: right;
        -moz-opacity: 0;
        filter: alpha(opacity: 0);
        opacity: 0;
        z-index: 2;
    }
</style>

<div id="outer" class="fileinputs">
    <input id="code" class="file" type="file" accept="image/*" capture="camera" onChange="load()">

    <div class="fakefile">
        <input type="button" class="button" value="Prendre photo" />
    </div>
    <img id="qr" src="" />
    <button id="send" class="button" onclick="decode()" disabled>Envoyer</button>
</div>

<script src="../bower_components/qcode-decoder/build/qcode-decoder.min.js"></script>


<script style="text/javascript">
    function load() {
        var input = document.getElementById('code');

        if (input.files && input.files[0]) {

            var reader = new FileReader();
            var img = document.getElementById('qr');
            reader.onload = function (e) {
                img.setAttribute('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
            document.getElementById('send').textContent = "Scan";
            document.getElementById('send').disabled = false;
        }
    }

    function decode() {
         var img = document.getElementById('qr');
        QCodeDecoder().decodeFromImage(img, function (er, res) {
            
            var scope = angular.element($("#outer")).scope();
            console.log('scope:', scope);
            scope.$apply(function () {
                scope.saveTable(res);
                alert(res);
            });     
        });
        window.location = "/#!/menu";
    }
</script>